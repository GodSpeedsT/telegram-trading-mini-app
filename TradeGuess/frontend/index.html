<!DOCTYPE html>
<html lang="ru">
    <head>
    <meta charset="UTF-8">
    <link rel="icon" href="/favicon.ico">

    <!-- КРИТИЧЕСКИ ВАЖНО для Telegram Mini App -->
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <meta name="format-detection" content="telephone=no">

    <!-- Заголовок приложения -->
    <title>TradeGuess - Telegram Trading Game</title>

    <!-- Telegram Web App SDK (ОБЯЗАТЕЛЬНО!) -->
    <script src="https://telegram.org/js/telegram-web-app.js"></script>

    <!-- ECharts через CDN (если используете) -->
    <script src="https://cdn.jsdelivr.net/npm/echarts@5.4.3/dist/echarts.min.js"></script>

    <!-- Предзагрузка шрифтов и критических ресурсов -->
    <link rel="preconnect" href="https://telegram.org">
    <link rel="preconnect" href="https://cdn.jsdelivr.net" crossorigin>

    <!-- Стили для корректного отображения в Telegram -->
    <style>
        /* Сброс стилей для корректной работы в Telegram */
        html, body {
            margin: 0;
            padding: 0;
            width: 100%;
            height: 100%;
            overflow: hidden;
            -webkit-tap-highlight-color: transparent;
            -webkit-touch-callout: none;
            -webkit-user-select: none;
            user-select: none;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, sans-serif;
        }

        /* Гарантируем, что приложение займет весь экран */
        #app {
            width: 100%;
            height: 100vh;
            height: -webkit-fill-available; /* Для iOS */
            overflow: auto;
            -webkit-overflow-scrolling: touch; /* Плавный скролл на iOS */
        }

        /* Скрываем скроллбар в Telegram */
        ::-webkit-scrollbar {
            display: none;
        }

        /* Оптимизация для темной/светлой темы Telegram */
        @media (prefers-color-scheme: dark) {
            body {
                background: #0f0f0f;
                color: #ffffff;
            }
        }
    </style>
</head>
<body>
<!-- Корневой элемент Vue -->
<div id="app"></div>

<!-- Скрипт инициализации Vue (Vite автоматически добавит правильный путь) -->
<script type="module" src="/src/app/main.ts"></script>

<!-- Скрипт для инициализации Telegram Web App -->
<script>
    // Проверяем, что находимся в Telegram Web App
    if (window.Telegram && window.Telegram.WebApp) {
        const tg = window.Telegram.WebApp;

        // Расширяем на весь экран (важно для Mini App)
        tg.expand();

        // Устанавливаем цвета в соответствии с темой Telegram
        tg.setHeaderColor(tg.themeParams.bg_color || '#2b6cb0');
        tg.setBackgroundColor(tg.themeParams.bg_color || '#ffffff');

        // Настраиваем кнопку "Назад"
        tg.BackButton.onClick(() => {
            if (window.history.length > 1) {
                window.history.back();
            } else {
                tg.close();
            }
        });

        // Логируем данные для отладки
        console.log('Telegram WebApp initialized:', {
            platform: tg.platform,
            version: tg.version,
            themeParams: tg.themeParams,
            user: tg.initDataUnsafe?.user
        });
    } else {
        console.log('Running outside Telegram WebApp (development mode)');

        // Для разработки вне Telegram эмулируем объект WebApp
        if (!window.Telegram) {
            window.Telegram = {
                WebApp: {
                    expand: () => console.log('expand() called'),
                    setHeaderColor: () => {},
                    setBackgroundColor: () => {},
                    BackButton: {
                        show: () => {},
                        hide: () => {},
                        onClick: () => {}
                    },
                    themeParams: {
                        bg_color: '#ffffff',
                        text_color: '#000000'
                    },
                    initDataUnsafe: {
                        user: {
                            id: 123456789,
                            first_name: 'Test',
                            last_name: 'User',
                            username: 'testuser'
                        }
                    },
                    platform: 'unknown',
                    version: '7.0'
                }
            };
        }
    }
</script>
    </body>
</html>